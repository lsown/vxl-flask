{% extends "base.html" %}

{% block styles %}

{{ super() }}
<style type="text/css">  
  .form-number {
      width: 6rem;
  }
</style>
{% endblock %}

{% block title %}<title>WebSockets</title>{% endblock %}

{% block content %}
<div class="c-mainGrid__child">
    <h2>Websocket Forms</h2>
    <div class ="c-panel panel7">
        <!--Example text form-->
        <form id="form1" action="/" method="post" action="#">
            <label for="input1">Enter text here: </label>
                <input type="text" size="8" maxlength="14" id="input1-text" name="input1" placeholder="text here">
                <span class="validity"></span>
            <button name="input1" id="input1-button" type="button">Submit</button>
        </form>
        <!--Example numerical form-->
        <form id="form2" action="/" method="post" action="#">
            <label for="input2">Set Filament Voltage: </label>
                <input type="number" class="form-number" id="input2-number" name="input2" value="" placeholder="voltage (V)" 
                step="0.10" min="0" max="10">
            <button name="input2" id="input2-button" type="button">Submit</button>
            <span id='testtoss'>0 V</span>
        </form>

        <form id="emit" method="POST" action='#'>
            <input type="text" name="emit_data" id="emit_data" placeholder="Message">
            <input type="submit" value="Echo">
        </form>
    </div>
</div>
<div class="c-mainGrid__child">
    <h2>Panel2</h2>
    <div class="c-panel panel2">
        <table class="c-table">
            <thead>
                <tr>
                    <th scope="col" class="c-table-th1">Descriptor Head</th>
                    <th scope="col" class="c-table-th2">Data Head</th>
                    <th scope="col" class="c-table-th3">Units Head</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td class='c-table-descriptor'>Descriptor-A</td>
                    <td class='c-table-data'>Data-A</td>
                    <td class='c-table-units'>Units-A</td>
                </tr>
                <tr>
                    <td class='c-table-descriptor'>Descriptor-B</td>
                    <td class='c-table-data'>Data-B</td>
                    <td class='c-table-units'>Units-B</td>
                </tr>
                <tr>
                    <td class='c-table-descriptor'>Descriptor-C</td>
                    <td class='c-table-data'>Data-C</td>
                    <td class='c-table-units'>Units-C</td>
                </tr>
                <tr>
                    <td class='c-table-descriptor'>Descriptor-D</td>
                    <td class='c-table-data'>Data-D</td>
                    <td class='c-table-units'>Units-D</td>
                </tr>
                <tr>
                    <td class='c-table-descriptor'>Descriptor-E</td>
                    <td class='c-table-data'>Data-E</td>
                    <td class='c-table-units'>Units-E</td>
                </tr>
                <tr>
                    <td class='c-table-descriptor'>Descriptor-F</td>
                    <td class='c-table-data'>Data-F</td>
                    <td class='c-table-units'>Units-F</td>
                </tr>
                <tr>
                    <td class='c-table-descriptor'>Descriptor-G</td>
                    <td class='c-table-data'>Data-G</td>
                    <td class='c-table-units'>Units-G</td>
                </tr>
            </tbody>
        </table>
    </div>
</div>
{% endblock %}

{% block morescripts %}
<script type="text/javascript" charset="utf-8">
    $(document).ready(function(){
        var socket = io();
        let input1Text= document.querySelector('#input1-text')
        socket.on('my response', function(msg) {
            $('#log').append('<p>Received: ' + msg.data + '</p>');
        });
        socket.on('input1_response', function(msg) {
            console.log('received data: ' + msg.data)
            //document.querySelector('#input1-text').setAttribute('placeholder', msg.data)
        })
        socket.on('input2_response', function(msg) {
            console.log('received data: ' + msg.data)
            //document.querySelector('#input2-number').setAttribute('value', msg.data)
            document.querySelector('#testtoss').textContent = msg.data + ' V'
        })

        socket.on('readback_msg', function(msg) {
            console.log('received data: ' + msg.data)
        })

        $('form#emit').submit(function(event) {
            socket.emit('my event', {data: $('#emit_data').val()});
            return false;
        });
        document.querySelector('#input1-button').addEventListener('click', () => {
            socket.emit('input1_event', {data: document.querySelector('#input1-text').value}); //send value from id to server
            document.querySelector('#input1-text').value = ''; //reset to blank
            return false;   //return false is to prevent normal data route
        });

        document.querySelector('#input2-button').addEventListener('click', () => {
            socket.emit('input2_event', {data: document.querySelector('#input2-number').value}); //send value from id to server
            document.querySelector('#input2-number').value = ''; //reset to blank
            return false;   //return false is to prevent normal data route
        });

        /*$('form#form1').submit(function(event) {
            socket.emit('input1_event', {data: document.querySelector('#input1').value});
            document.querySelector('#input1').value = '';
            return false;
        });*/
        $('form#broadcast').submit(function(event) {
            socket.emit('my broadcast event', {data: $('#broadcast_data').val()});
            return false;
        });
    });



</script>
{% endblock %}
